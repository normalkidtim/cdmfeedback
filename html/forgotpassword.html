<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://cdn.boxicons.com/3.0.3/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="../css/login.css"> 
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>Reset Password</title>
</head>
<body class="login-page-body">

    <div class="wrapper"> 
        <span class="bg-animate"></span>
        <span class="bg-animate2"></span>
        
        <div class="form-box login">
            <h2 class="animation" style="--i:0;--j:21;">Reset Password</h2>
            
            <form action="#" onsubmit="return false;">
                <div class="input-box animation" style="--i:1;--j:22;">
                    <input type="email" id="resetEmail" placeholder="" required>
                    <label>Enter your registered Email</label>
                    <i class='bx bx-envelope'></i> 
                </div>

                <button type="button" class="btn animation" onclick="handlePasswordReset()" style="--i:3;--j:24;">
                    Send Reset Link
                </button>

                <div class="logreg-link animation" style="--i:4;--j:25;">
                    <p><a href="login-register.html" class="register-link" > â¬… Back to Login</a></p>
                </div>
            </form>
        </div>

        <div class="info-text login">
            <h2 class="animation" style="--i:0;--j:20;">Forgot Password</h2>
            <p> <img src="../img/logo.jpg" alt="CDM Logo" class="logo-img" style="width:180px"> </p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCImQfezmlDpQPV_-gKFykIhcASJxv2RdY",
            authDomain: "cdm-feedback.firebaseapp.com",
            projectId: "cdm-feedback",
            storageBucket: "cdm-feedback.firebasestorage.app",
            messagingSenderId: "219362528866",
            appId: "1:219362528866:web:207d114926d4dddb6e4b3b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        window.handlePasswordReset = function() {
            const email = document.getElementById('resetEmail').value;

            if (!email) {
                Swal.fire('Error', 'Please enter your email address.', 'error');
                return;
            }

            Swal.fire({
                title: 'Sending Link...',
                text: 'Please wait.',
                allowOutsideClick: false,
                didOpen: () => { Swal.showLoading(); }
            });

            sendPasswordResetEmail(auth, email)
                .then(() => {
                    Swal.fire({
                        title: 'Link Sent!',
                        html: `We sent a reset link to <strong>${email}</strong>.<br>Please check your inbox (and spam).`,
                        icon: 'success',
                        confirmButtonColor: '#69da8f'
                    }).then(() => {
                        window.location.href = "index.html";
                    });
                })
                .catch((error) => {
                    console.error(error);
                    let msg = "Failed to send reset link.";
                    if (error.code === 'auth/user-not-found') {
                        msg = "This email is not registered.";
                    }
                    Swal.fire('Error', msg, 'error');
                });
        }
    </script>
</body>
</html>